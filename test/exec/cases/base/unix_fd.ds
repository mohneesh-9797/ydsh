#$test($status = 1)

assert $STDIN && $STDOUT && $STDERR
assert $STDIN as String == "/dev/fd/0"
assert $STDOUT as String == "/dev/fd/1"
assert $STDERR as String == '/dev/fd/2'

var fd = $STDIN.dup()
assert $fd as String  != "/dev/fd/0"
assert $fd
assert $fd as Boolean

$fd.close()
assert $fd as String == "/dev/fd/-1" as String
assert ! $fd
assert $false == $fd

var ex = 34 as Any
try {
    $fd.dup()
} catch $e {
    $ex = $e
}
assert $ex is SystemError

$ex = 34
try {
    $fd.close()
} catch $e {
    $ex = $e
}
assert $ex is SystemError

$ex = 34
try {
    cat < $fd
} catch $e {
    $ex = $e
}
assert $ex is SystemError

# close-on-exec
$fd = <(echo hello)
assert "$(cat $fd)" == "hello"
$fd.close()

$fd = <(echo world)
$fd.closeOnExec($true)
assert "$(cat $fd)".empty()
